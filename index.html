<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo list</title>

    <style>
        ul {
            list-style-type: none;
        }
        .done {
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <img src="https://i.pinimg.com/564x/5b/39/12/5b39125cf21f51c38c475d86045957f5.jpg" width="50" />
    <fieldset>
        <legend>Todo list</legend>
        <form onsubmit="enviar()">
            <input type="text" name="descricao" value="" placeholder="digite aqui" />
            <input type="submit" value="Adicionar" />

        </form>
    </fieldset>

    <ul></ul>

    <script>
        const localLista = localStorage.getItem("@todo")
        let listaGlobal = localLista ? JSON.parse(localLista) : [{ descricao: 'escovar os dentes', done: true }]

        function criaLista(list) {
            document.querySelector("ul").innerHTML = ''
            list.sort((a, b) => {
                return Number(a.done) - Number(b.done)
            })
            list.forEach(item => {
                const li = criarItemNaListaNoHtml(item)
                document.querySelector("ul").appendChild(li);
            })
            localStorage.setItem("@todo", JSON.stringify(list));
        }

        function removeItem(item) {
            listaGlobal = listaGlobal.filter(it => it.descricao !== item.descricao)
            criaLista(listaGlobal)
        }

        function criarItemNaListaNoHtml(item) {
            const remove = document.createElement("button");
            remove.innerText = "x"
            const checkbox = document.createElement("input");
            checkbox.type = 'checkbox'
            checkbox.checked = item.done;

            checkbox.onchange = (e) => {
                item.done = e.target.checked;
                criaLista(listaGlobal);
            }

            remove.onclick = () => {
                removeItem(item)
            }

            const li = document.createElement("li");
            li.className = item.done ? 'done' : ''
            const spanDesc = document.createElement("span");
            spanDesc.innerText = item.descricao
            li.append(checkbox, remove, spanDesc)
            return li
        }



        function enviar() {
            event.preventDefault()
            const allFields = [...event.target.elements]
            const descricao = allFields.find(item => item.name === 'descricao')

            if (descricao.value === "") return
            if (listaGlobal.includes(descricao.value)) return

            listaGlobal.push({
                descricao: descricao.value,
                done: false
            });

            criaLista(listaGlobal)
            event.target.reset()
        }

        // window.onload = () => {
        //     console.log("carregou!")
        // }

        document.querySelector("img").onload = () => {
            console.log("carregou pela img!")
        }
        document.querySelector("img").onerror = (e) => {
            console.log("deu ruim pela img!", e)
        }

        window.addEventListener("load", () => {
            criaLista(listaGlobal)
        })


    </script>
</body>

</html>